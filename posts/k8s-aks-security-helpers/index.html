<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><title>Kube-bench and Popeye: A Power Duo for AKS Security Compliance &#183; Cloudy Caffeine with Ana</title>
<meta name=title content="Kube-bench and Popeye: A Power Duo for AKS Security Compliance &#183; Cloudy Caffeine with Ana"><meta name=description content="A blog about cloud, tech and coffee"><meta name=keywords content="kubernetes,security,"><link rel=canonical href=https://ana-cozma.github.io/posts/k8s-aks-security-helpers/><link type=text/css rel=stylesheet href=/css/main.bundle.min.85f006de1806b55b2d082d1122deedd8cec6fdc1f7c8a51be975a4496165d6c798f4a3de52545a6a87cc4bc09fc2d6f5201d44ea57acc1ac2b1c42a688c62bee.css integrity="sha512-hfAG3hgGtVstCC0RIt7t2M7G/cH3yKUb6XWkSWFl1seY9KPeUlRaaofMS8Cfwtb1IB1E6leswawrHEKmiMYr7g=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.f5c7687e2a3365a5a366307858918deafa574ab869c626f69dcdd5363e26a725991d0efa1aaaff7ba4b7e2472876189d153d2f9b46a39206caf364407e2aaa77.js integrity="sha512-9cdofiozZaWjZjB4WJGN6vpXSrhpxib2nc3VNj4mpyWZHQ76Gqr/e6S34kcodhidFT0vm0ajkgbK82RAfiqqdw==" data-copy data-copied></script><script src=/js/zoom.min.js></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://ana-cozma.github.io/posts/k8s-aks-security-helpers/"><meta property="og:site_name" content="Cloudy Caffeine with Ana"><meta property="og:title" content="Kube-bench and Popeye: A Power Duo for AKS Security Compliance"><meta property="og:description" content="In today’s world, security is a top priority for any organization or at least it should be."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-23T19:10:37+01:00"><meta property="article:modified_time" content="2023-01-23T19:10:37+01:00"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="Security"><meta name=twitter:card content="summary"><meta name=twitter:title content="Kube-bench and Popeye: A Power Duo for AKS Security Compliance"><meta name=twitter:description content="In today’s world, security is a top priority for any organization or at least it should be."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Kube-bench and Popeye: A Power Duo for AKS Security Compliance","headline":"Kube-bench and Popeye: A Power Duo for AKS Security Compliance","abstract":"In today\u0026rsquo;s world, security is a top priority for any organization or at least it should be.","inLanguage":"en","url":"https:\/\/ana-cozma.github.io\/posts\/k8s-aks-security-helpers\/","author":{"@type":"Person","name":"Ana Cozma"},"copyrightYear":"2023","dateCreated":"2023-01-23T19:10:37\u002b01:00","datePublished":"2023-01-23T19:10:37\u002b01:00","dateModified":"2023-01-23T19:10:37\u002b01:00","keywords":["kubernetes","security"],"mainEntityOfPage":"true","wordCount":"6576"}]</script><meta name=author content="Ana Cozma"><link href=https://github.com/ana-cozma rel=me><link href=https://www.linkedin.com/in/ana-cozma/ rel=me><link href=https://x.com/the_cozma rel=me><script src=/lib/jquery/jquery.slim.min.js integrity></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-PD4F67ZWJD"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PD4F67ZWJD")</script><meta name=theme-color></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 pl-[24px] pr-[24px]" style=z-index:100><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div><div class="relative max-w-[64rem] ml-auto mr-auto"><div style=padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">Cloudy Caffeine with Ana</a></nav><nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12"><a href=/about/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title>About</p></a><a href=/posts/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title>Posts</p></a><a href=/reads/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title>Reads</p></a><a href=/tags/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title>Tags</p></a><a href class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title></p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="ltr:mr-14 rtl:ml-14 flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center space-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400" style=margin-right:5px><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 -mr-2 md:hidden"><label id=menu-button for=menu-controller class=block><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:5px class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/about/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title>About</p></a></li><li class=mt-1><a href=/posts/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title>Posts</p></a></li><li class=mt-1><a href=/reads/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title>Reads</p></a></li><li class=mt-1><a href=/tags/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title>Tags</p></a></li><li class=mt-1><a href class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title></p></a></li></ul></div></label></div></div><script>(function(){var e=$(".main-menu"),t=window.location.pathname;e.find('a[href="'+t+'"]').each(function(e,t){$(t).children("p").addClass("active")})})()</script></div></div><script>window.addEventListener("scroll",function(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n=document.getElementById("menu-blur");n.style.opacity=t/300})</script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div id=hero class="h-[150px] md:h-[200px]"></div><div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom" style=background-image:url(/image_hu5459c0360c2b0cb7a147d2df0eb350ca_2995372_1200x0_resize_q75_box.jpg)><div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div><div class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div></div><div id=background-blur class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div><script>window.addEventListener("scroll",function(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n=document.getElementById("background-blur");n.style.opacity=t/300})</script><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Kube-bench and Popeye: A Power Duo for AKS Security Compliance</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2023-01-23 19:10:37 +0100 +0100">23 January 2023</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">31 mins</span><span class="px-2 text-primary-500">&#183;</span>
<script type=text/javascript src=/js/zen-mode.min.63c8a202661f4a2063fdc2706685d668e8ea3da613da2224e9da527e5876e4f53dcac39ab60732626fb4151feae5d430d0cf44731e5d3c726522fcc1519c1547.js integrity="sha512-Y8iiAmYfSiBj/cJwZoXWaOjqPaYT2iIk6dpSflh25PU9ysOatgcyYm+0FR/q5dQw0M9Ecx5dPHJlIvzBUZwVRw=="></script><span class=mb-[2px]><span id=zen-mode-button class="text-lg hover:text-primary-500" title="Enable zen mode" data-title-i18n-disable="Enable zen mode" data-title-i18n-enable="Disable zen mode"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="50" height="50"><path fill="currentcolor" d="M12.980469 4C9.1204688 4 5.9804688 7.14 5.9804688 11L6 26H9.9804688V11c0-1.65 1.3400002-3 3.0000002-3H40.019531c1.66.0 3 1.35 3 3V39c0 1.65-1.34 3-3 3H29c0 1.54-.579062 2.94-1.539062 4H40.019531c3.86.0 7-3.14 7-7V11c0-3.86-3.14-7-7-7H12.980469zM7 28c-2.206.0-4 1.794-4 4V42c0 2.206 1.794 4 4 4H23c2.206.0 4-1.794 4-4V32c0-2.206-1.794-4-4-4H7zm0 4H23L23.001953 42H7V32z"/></svg></span></span></span></span></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/kubernetes/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Kubernetes
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/security/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Security</span></span></span></div></div><div class="flex author"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 alt="Ana Cozma" src=/avatar_hu020786788dd8670e1b7a7a4e29dea84d_207174_192x192_fill_q75_box_center.jpg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Ana Cozma</div><div class="text-sm text-neutral-700 dark:text-neutral-400">I’m a Cloud Engineer with a knack for CI/CD pipelines, Docker, Kubernetes, Azure and AWS with a focus on IaC, monitoring, and security. Let’s connect!</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/ana-cozma target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.linkedin.com/in/ana-cozma/ target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://x.com/the_cozma target=_blank aria-label=X-Twitter rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]"><details open id=TOCView class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#azure-security-baseline-for-aks>Azure Security Baseline for AKS</a></li><li><a href=#microsoft-defender-for-cloud>Microsoft Defender for Cloud</a></li><li><a href=#kube-bench>Kube-bench</a><ul><li><a href=#setting-it-up>Setting it up</a></li><li><a href=#the-report-breakdown>The report breakdown</a></li><li><a href=#potential-use-cases>Potential use cases</a></li></ul></li><li><a href=#popeye---a-kubernetes-cluster-sanitizer>Popeye - A Kubernetes Cluster Sanitizer</a><ul><li><a href=#setting-it-up-1>Setting it up</a></li><li><a href=#the-report-breakdown-1>The report breakdown</a></li><li><a href=#potential-use-cases-1>Potential use cases</a></li></ul></li><li><a href=#summary>Summary</a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#azure-security-baseline-for-aks>Azure Security Baseline for AKS</a></li><li><a href=#microsoft-defender-for-cloud>Microsoft Defender for Cloud</a></li><li><a href=#kube-bench>Kube-bench</a><ul><li><a href=#setting-it-up>Setting it up</a></li><li><a href=#the-report-breakdown>The report breakdown</a></li><li><a href=#potential-use-cases>Potential use cases</a></li></ul></li><li><a href=#popeye---a-kubernetes-cluster-sanitizer>Popeye - A Kubernetes Cluster Sanitizer</a><ul><li><a href=#setting-it-up-1>Setting it up</a></li><li><a href=#the-report-breakdown-1>The report breakdown</a></li><li><a href=#potential-use-cases-1>Potential use cases</a></li></ul></li><li><a href=#summary>Summary</a></li></ul></nav></div></details><script>var margin=200,marginError=50;(function(){var t=$(window),e=$("#TOCView"),s=e.height();function n(){var n=t.height()-margin;s>=n?(e.css("overflow-y","scroll"),e.css("max-height",n+marginError+"px")):(e.css("overflow-y","hidden"),e.css("max-height","9999999px"))}t.on("resize",n),$(document).ready(n)})(),function(){var t,e=$("#TableOfContents");if(e.length>0){t=$(window);function n(){var s,o=t.scrollTop(),i=$(".anchor"),n="";if(i.each(function(e,t){t=$(t),t.offset().top-$(window).height()/3<=o&&(n=decodeURIComponent(t.attr("id")))}),s=e.find("a.active"),s.length==1&&s.eq(0).attr("href")=="#"+n)return!0;s.each(function(e,t){$(t).removeClass("active")}),e.find('a[href="#'+n+'"]').addClass("active"),e.find('a[href="#'+n+'"]').parentsUntil("#TableOfContents").each(function(e,t){$(t).children("a").parents("ul").show()})}t.on("scroll",n),$(document).ready(function(){n()})}}()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><p>In today&rsquo;s world, security is a top priority for any organization or at least it should be. With the rise of cloud computing, the number of security threats has increased exponentially.</p><p>So how do we keep up? Where do we start?</p><p>Microsoft has created a set of security benchmarks to give users a starting point for setting up their security configurations. The Microsoft cloud security benchmark (MCSB) is the successor of Azure Security Benchmark (ASB), which was rebranded in October 2022 (Currently in public preview).</p><p>In this post, I would like to go over the Azure security baseline for Azure Kubernetes Service and give a shoutout to two tools that can aid you in the process of establishing your compliance with the baseline.</p><h2 class="relative group">Azure Security Baseline for AKS<div id=azure-security-baseline-for-aks class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#azure-security-baseline-for-aks aria-label=Anchor>#</a></span></h2><p>The Azure Security Baseline for <a href=https://learn.microsoft.com/en-us/security/benchmark/azure/baselines/aks-security-baseline target=_blank>Azure Kubernetes Service</a> (AKS) is a set of recommendations for securing your AKS cluster.</p><p>It is an exhaustive list of various aspects of AKS security and it also provides the corresponding actions to be taken in each case. From the documentation&rsquo;s overview:</p><blockquote><p><em>You can monitor this security baseline and its recommendations using Microsoft Defender for Cloud. Azure Policy definitions will be listed in the Regulatory Compliance section of the Microsoft Defender for Cloud dashboard.</em></p></blockquote><blockquote><p><em>When a section has relevant Azure Policy Definitions, they are listed in this baseline to help you measure compliance to the Azure Security Benchmark controls and recommendations. Some recommendations may require a paid Microsoft Defender plan to enable certain security scenarios.</em></p></blockquote><p>It is based on the CIS Kubernetes Benchmark and the Azure Security Benchmark v1.0.</p><blockquote><p><em>CIS Benchmarks are best practices for the secure configuration of a target system. Available for more than 100 CIS Benchmarks across 25+ vendor product families, CIS Benchmarks are developed through a unique consensus-based process comprised of cybersecurity professionals and subject matter experts around the world. CIS Benchmarks are the only consensus-based, best-practice security configuration guides both developed and accepted by government, business, industry, and academia.</em></p></blockquote><p>For more information on <strong>CIS Benchmark</strong> please check <a href=https://www.cisecurity.org/cis-benchmarks/cis-benchmarks-faq target=_blank>CIS Benchmark FAQ</a>.</p><p>For more information on the <strong>CIS Benchmark for Kubernetes</strong> please check the <a href=https://www.cisecurity.org/benchmark/kubernetes target=_blank>kubernetes benchmark</a>.</p><p>In the CIS Benchmark for Kubernetes document, there are instructions for both Master nodes and Worker nodes. But when using AKS we don&rsquo;t have access to the master nodes. In this case, we can make use of the <a href=https://www.cisecurity.org/insights/blog/new-release-cis-azure-kubernetes-service-aks-benchmark target=_blank>CIS Benchmark document for AKS</a>.</p><p><strong>What could we use to help us check our AKS setup against this benchmark?</strong></p><p>We can start by looking at the Azure Portal and <strong>Microsoft Defender for Cloud</strong>, checking out CIS compliance with <strong>Kube-bench</strong> and any configuration mismatches with <strong>Popeye</strong>. I will go into more detail on the last two tools. But first, let&rsquo;s see what Microsoft Defender for Cloud looks like and what can you get from it.</p><h2 class="relative group">Microsoft Defender for Cloud<div id=microsoft-defender-for-cloud class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#microsoft-defender-for-cloud aria-label=Anchor>#</a></span></h2><p>As suggested by Microsoft, we can start with Microsoft Defender for Cloud.
If you go to Azure Portal and search for Microsoft Defender for Cloud, then filter by &ldquo;Assessed Resources&rdquo;, and select your cluster you will see a list of all the cluster details and <em>Recommendations</em> and the <em>Alerts</em> tab as well.</p><p><figure><img class="my-0 rounded-md" loading=lazy srcset="/posts/k8s-aks-security-helpers/azureportal_huc5fd0af16e77472c8276a99c53918ffb_221859_330x0_resize_box_3.png 330w,
/posts/k8s-aks-security-helpers/azureportal_huc5fd0af16e77472c8276a99c53918ffb_221859_660x0_resize_box_3.png 660w,
/posts/k8s-aks-security-helpers/azureportal_huc5fd0af16e77472c8276a99c53918ffb_221859_1024x0_resize_box_3.png 1024w,
/posts/k8s-aks-security-helpers/azureportal_huc5fd0af16e77472c8276a99c53918ffb_221859_1320x0_resize_box_3.png 2x" src=/posts/k8s-aks-security-helpers/azureportal_huc5fd0af16e77472c8276a99c53918ffb_221859_660x0_resize_box_3.png alt="Microsoft Defender for Cloud"></figure></p><p>Let&rsquo;s take the first recommendation as an example:
<em>Azure Kubernetes Service clusters should have Defender profile enabled</em></p><p>If you click on it and expand it will give you the following information:<figure><img class="my-0 rounded-md" loading=lazy srcset="/posts/k8s-aks-security-helpers/detail_hu14aba05030288827c46a90eadc9a6ea9_150791_330x0_resize_box_3.png 330w,
/posts/k8s-aks-security-helpers/detail_hu14aba05030288827c46a90eadc9a6ea9_150791_660x0_resize_box_3.png 660w,
/posts/k8s-aks-security-helpers/detail_hu14aba05030288827c46a90eadc9a6ea9_150791_1024x0_resize_box_3.png 1024w,
/posts/k8s-aks-security-helpers/detail_hu14aba05030288827c46a90eadc9a6ea9_150791_1320x0_resize_box_3.png 2x" src=/posts/k8s-aks-security-helpers/detail_hu14aba05030288827c46a90eadc9a6ea9_150791_660x0_resize_box_3.png alt=Detail></figure></p><p>You can choose to Exempt it, meaning you have either fixed this issue or you don&rsquo;t want to fix it or Enforce it, meaning you want to enforce this setting by adding it to an Azure Policy definition.</p><p>There is also a nice description of the issue and suggested remediation steps to take.</p><p><figure><img class="my-0 rounded-md" loading=lazy srcset="/posts/k8s-aks-security-helpers/kube-bench_hud453eaacdac31f97f6ae1eef4bfdad75_50302_330x0_resize_box_3.png 330w,
/posts/k8s-aks-security-helpers/kube-bench_hud453eaacdac31f97f6ae1eef4bfdad75_50302_660x0_resize_box_3.png 660w,
/posts/k8s-aks-security-helpers/kube-bench_hud453eaacdac31f97f6ae1eef4bfdad75_50302_1024x0_resize_box_3.png 1024w,
/posts/k8s-aks-security-helpers/kube-bench_hud453eaacdac31f97f6ae1eef4bfdad75_50302_1320x0_resize_box_3.png 2x" src=/posts/k8s-aks-security-helpers/kube-bench_hud453eaacdac31f97f6ae1eef4bfdad75_50302_660x0_resize_box_3.png alt=Kube-bench></figure></p><h2 class="relative group">Kube-bench<div id=kube-bench class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#kube-bench aria-label=Anchor>#</a></span></h2><p>The official repository can be found <a href=https://github.com/aquasecurity/kube-bench target=_blank>here</a> with detailed installation instructions.</p><blockquote><p><em>kube-bench is a tool that checks whether Kubernetes is deployed securely by running the checks documented in the CIS Kubernetes Benchmark.</em></p></blockquote><p>There are multiple ways of running this tool that you can check <a href=https://github.com/aquasecurity/kube-bench/blob/main/docs/running.md target=_blank>here</a>.</p><h3 class="relative group">Setting it up<div id=setting-it-up class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#setting-it-up aria-label=Anchor>#</a></span></h3><p>To test out this tool, I decided to just apply it to my local cluster so the first thing I did was start my <a href=https://minikube.sigs.k8s.io/docs/start/ target=_blank>minikube</a> instance and then I ran the following command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; minikube start
</span></span><span class=line><span class=cl>😄  minikube v1.22.0 on Darwin 12.6.2
</span></span><span class=line><span class=cl>✨  Using the hyperkit driver based on existing profile
</span></span><span class=line><span class=cl>👍  Starting control plane node minikube in cluster minikube
</span></span><span class=line><span class=cl>🏃  Updating the running hyperkit <span class=s2>&#34;minikube&#34;</span> VM ...
</span></span><span class=line><span class=cl>🎉  minikube 1.28.0 is available! Download it: https://github.com/kubernetes/minikube/releases/tag/v1.28.0
</span></span><span class=line><span class=cl>💡  To disable this notice, run: <span class=s1>&#39;minikube config set WantUpdateNotification false&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>🐳  Preparing Kubernetes v1.21.2 on Docker 20.10.6 ...
</span></span><span class=line><span class=cl>🔎  Verifying Kubernetes components...
</span></span><span class=line><span class=cl>    ▪ Using image gcr.io/k8s-minikube/storage-provisioner:v5
</span></span><span class=line><span class=cl>🌟  Enabled addons: storage-provisioner, default-storageclass
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>❗  /usr/local/bin/kubectl is version 1.25.2, which may have incompatibilites with Kubernetes 1.21.2.
</span></span><span class=line><span class=cl>    ▪ Want kubectl v1.21.2? Try <span class=s1>&#39;minikube kubectl -- get pods -A&#39;</span>
</span></span><span class=line><span class=cl>🏄  Done! kubectl is now configured to use <span class=s2>&#34;minikube&#34;</span> cluster and <span class=s2>&#34;default&#34;</span> namespace by default
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Download the job.yaml file</span>
</span></span><span class=line><span class=cl>&gt; curl https://raw.githubusercontent.com/aquasecurity/kube-bench/main/job.yaml &gt; job.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt; kubectl apply -f job.yaml
</span></span><span class=line><span class=cl>job.batch/kube-bench created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt; kubectl get pods -A                                                                                                                                ✔  at minikube ⎈ 
</span></span><span class=line><span class=cl>NAMESPACE       NAME                                        READY   STATUS              RESTARTS   AGE
</span></span><span class=line><span class=cl>default         kube-bench-t2fgh                            0/1     ContainerCreating   <span class=m>0</span>          5s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt; kubectl get pods -A                                                                                                                                ✔  at minikube ⎈
</span></span><span class=line><span class=cl>NAMESPACE       NAME                                        READY   STATUS      RESTARTS   AGE
</span></span><span class=line><span class=cl>default         kube-bench-t2fgh                            0/1     Completed   <span class=m>0</span>          32s
</span></span></code></pre></div><p>You can run Kube-bench inside a pod, but it will need access to the host&rsquo;s PID namespace to check the running processes, as well as access to some directories on the host where config files and other files are stored.</p><p>The supplied <code>job.yaml</code> file can be applied to run the tests as a job. This was enough for me to run locally to get a feel of what the tool does and how it generates the report.</p><p>Next, after having run the tests, I wanted to get the report. The results of the tests can be found in the logs of the pod which you can get by running:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; kubectl logs kube-bench-t2fgh
</span></span></code></pre></div><p>Kube-bench generates a report that looks like the following:</p><details><summary>Click here to expand report</summary><pre tabindex=0><code class=language-log data-lang=log>[INFO] 1 Master Node Security Configuration
[INFO] 1.1 Master Node Configuration Files
[PASS] 1.1.1 Ensure that the API server pod specification file permissions are set to 644 or more restrictive (Automated)
[PASS] 1.1.2 Ensure that the API server pod specification file ownership is set to root:root (Automated)
[PASS] 1.1.3 Ensure that the controller manager pod specification file permissions are set to 644 or more restrictive (Automated)
[PASS] 1.1.4 Ensure that the controller manager pod specification file ownership is set to root:root (Automated)
[PASS] 1.1.5 Ensure that the scheduler pod specification file permissions are set to 644 or more restrictive (Automated)
[PASS] 1.1.6 Ensure that the scheduler pod specification file ownership is set to root:root (Automated)
[PASS] 1.1.7 Ensure that the etcd pod specification file permissions are set to 644 or more restrictive (Automated)
[PASS] 1.1.8 Ensure that the etcd pod specification file ownership is set to root:root (Automated)
[WARN] 1.1.9 Ensure that the Container Network Interface file permissions are set to 644 or more restrictive (Manual)
[WARN] 1.1.10 Ensure that the Container Network Interface file ownership is set to root:root (Manual)
[FAIL] 1.1.11 Ensure that the etcd data directory permissions are set to 700 or more restrictive (Automated)
[FAIL] 1.1.12 Ensure that the etcd data directory ownership is set to etcd:etcd (Automated)
[PASS] 1.1.13 Ensure that the admin.conf file permissions are set to 644 or more restrictive (Automated)
[PASS] 1.1.14 Ensure that the admin.conf file ownership is set to root:root (Automated)
[PASS] 1.1.15 Ensure that the scheduler.conf file permissions are set to 644 or more restrictive (Automated)
[PASS] 1.1.16 Ensure that the scheduler.conf file ownership is set to root:root (Automated)
[PASS] 1.1.17 Ensure that the controller-manager.conf file permissions are set to 644 or more restrictive (Automated)
[PASS] 1.1.18 Ensure that the controller-manager.conf file ownership is set to root:root (Automated)
[FAIL] 1.1.19 Ensure that the Kubernetes PKI directory and file ownership is set to root:root (Automated)
[WARN] 1.1.20 Ensure that the Kubernetes PKI certificate file permissions are set to 644 or more restrictive (Manual)
[WARN] 1.1.21 Ensure that the Kubernetes PKI key file permissions are set to 600 (Manual)
[INFO] 1.2 API Server
[WARN] 1.2.1 Ensure that the --anonymous-auth argument is set to false (Manual)
[PASS] 1.2.2 Ensure that the --token-auth-file parameter is not set (Automated)
[PASS] 1.2.3 Ensure that the --kubelet-https argument is set to true (Automated)
[PASS] 1.2.4 Ensure that the --kubelet-client-certificate and --kubelet-client-key arguments are set as appropriate (Automated)
[FAIL] 1.2.5 Ensure that the --kubelet-certificate-authority argument is set as appropriate (Automated)
[PASS] 1.2.6 Ensure that the --authorization-mode argument is not set to AlwaysAllow (Automated)
[PASS] 1.2.7 Ensure that the --authorization-mode argument includes Node (Automated)
[PASS] 1.2.8 Ensure that the --authorization-mode argument includes RBAC (Automated)
[WARN] 1.2.9 Ensure that the admission control plugin EventRateLimit is set (Manual)
[PASS] 1.2.10 Ensure that the admission control plugin AlwaysAdmit is not set (Automated)
[WARN] 1.2.11 Ensure that the admission control plugin AlwaysPullImages is set (Manual)
[WARN] 1.2.12 Ensure that the admission control plugin SecurityContextDeny is set if PodSecurityPolicy is not used (Manual)
[PASS] 1.2.13 Ensure that the admission control plugin ServiceAccount is set (Automated)
[PASS] 1.2.14 Ensure that the admission control plugin NamespaceLifecycle is set (Automated)
[FAIL] 1.2.15 Ensure that the admission control plugin PodSecurityPolicy is set (Automated)
[PASS] 1.2.16 Ensure that the admission control plugin NodeRestriction is set (Automated)
[PASS] 1.2.17 Ensure that the --insecure-bind-address argument is not set (Automated)
[PASS] 1.2.18 Ensure that the --insecure-port argument is set to 0 (Automated)
[PASS] 1.2.19 Ensure that the --secure-port argument is not set to 0 (Automated)
[FAIL] 1.2.20 Ensure that the --profiling argument is set to false (Automated)
[FAIL] 1.2.21 Ensure that the --audit-log-path argument is set (Automated)
[FAIL] 1.2.22 Ensure that the --audit-log-maxage argument is set to 30 or as appropriate (Automated)
[FAIL] 1.2.23 Ensure that the --audit-log-maxbackup argument is set to 10 or as appropriate (Automated)
[FAIL] 1.2.24 Ensure that the --audit-log-maxsize argument is set to 100 or as appropriate (Automated)
[WARN] 1.2.25 Ensure that the --request-timeout argument is set as appropriate (Manual)
[PASS] 1.2.26 Ensure that the --service-account-lookup argument is set to true (Automated)
[PASS] 1.2.27 Ensure that the --service-account-key-file argument is set as appropriate (Automated)
[PASS] 1.2.28 Ensure that the --etcd-certfile and --etcd-keyfile arguments are set as appropriate (Automated)
[PASS] 1.2.29 Ensure that the --tls-cert-file and --tls-private-key-file arguments are set as appropriate (Automated)
[PASS] 1.2.30 Ensure that the --client-ca-file argument is set as appropriate (Automated)
[PASS] 1.2.31 Ensure that the --etcd-cafile argument is set as appropriate (Automated)
[WARN] 1.2.32 Ensure that the --encryption-provider-config argument is set as appropriate (Manual)
[WARN] 1.2.33 Ensure that encryption providers are appropriately configured (Manual)
[WARN] 1.2.34 Ensure that the API Server only makes use of Strong Cryptographic Ciphers (Manual)
[INFO] 1.3 Controller Manager
[WARN] 1.3.1 Ensure that the --terminated-pod-gc-threshold argument is set as appropriate (Manual)
[FAIL] 1.3.2 Ensure that the --profiling argument is set to false (Automated)
[PASS] 1.3.3 Ensure that the --use-service-account-credentials argument is set to true (Automated)
[PASS] 1.3.4 Ensure that the --service-account-private-key-file argument is set as appropriate (Automated)
[PASS] 1.3.5 Ensure that the --root-ca-file argument is set as appropriate (Automated)
[PASS] 1.3.6 Ensure that the RotateKubeletServerCertificate argument is set to true (Automated)
[PASS] 1.3.7 Ensure that the --bind-address argument is set to 127.0.0.1 (Automated)
[INFO] 1.4 Scheduler
[FAIL] 1.4.1 Ensure that the --profiling argument is set to false (Automated)
[PASS] 1.4.2 Ensure that the --bind-address argument is set to 127.0.0.1 (Automated)

== Remediations master ==
1.1.9 Run the below command (based on the file location on your system) on the master node.
For example,
chmod 644 &lt;path/to/cni/files&gt;

1.1.10 Run the below command (based on the file location on your system) on the master node.
For example,
chown root:root &lt;path/to/cni/files&gt;

1.1.11 On the etcd server node, get the etcd data directory, passed as an argument --data-dir,
from the below command:
ps -ef | grep etcd
Run the below command (based on the etcd data directory found above). For example,
chmod 700 /var/lib/etcd

1.1.12 On the etcd server node, get the etcd data directory, passed as an argument --data-dir,
from the below command:
ps -ef | grep etcd
Run the below command (based on the etcd data directory found above).
For example, chown etcd:etcd /var/lib/etcd

1.1.19 Run the below command (based on the file location on your system) on the master node.
For example,
chown -R root:root /etc/kubernetes/pki/

1.2.5 Follow the Kubernetes documentation and setup the TLS connection between
the apiserver and kubelets. Then, edit the API server pod specification file
/etc/kubernetes/manifests/kube-apiserver.yaml on the master node and set the
--kubelet-certificate-authority parameter to the path to the cert file for the certificate authority.
--kubelet-certificate-authority=&lt;ca-string&gt;

1.2.9 Follow the Kubernetes documentation and set the desired limits in a configuration file.
Then, edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
and set the below parameters.
--enable-admission-plugins=...,EventRateLimit,...
--admission-control-config-file=&lt;path/to/configuration/file&gt;

1.2.11 Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the master node and set the --enable-admission-plugins parameter to include
AlwaysPullImages.
--enable-admission-plugins=...,AlwaysPullImages,...

1.2.12 Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the master node and set the --enable-admission-plugins parameter to include
SecurityContextDeny, unless PodSecurityPolicy is already in place.
--enable-admission-plugins=...,SecurityContextDeny,...

1.2.15 Follow the documentation and create Pod Security Policy objects as per your environment.
Then, edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the master node and set the --enable-admission-plugins parameter to a
value that includes PodSecurityPolicy:
--enable-admission-plugins=...,PodSecurityPolicy,...
Then restart the API Server.

1.2.20 Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the master node and set the below parameter.
--profiling=false

1.2.21 Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the master node and set the --audit-log-path parameter to a suitable path and
file where you would like audit logs to be written, for example:
--audit-log-path=/var/log/apiserver/audit.log

1.2.22 Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the master node and set the --audit-log-maxage parameter to 30 or as an appropriate number of days:
--audit-log-maxage=30

1.2.23 Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the master node and set the --audit-log-maxbackup parameter to 10 or to an appropriate
value.
--audit-log-maxbackup=10

1.2.24 Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the master node and set the --audit-log-maxsize parameter to an appropriate size in MB.
For example, to set it as 100 MB:
--audit-log-maxsize=100

1.2.25 Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
and set the below parameter as appropriate and if needed.
For example,
--request-timeout=300s

1.2.32 Follow the Kubernetes documentation and configure a EncryptionConfig file.
Then, edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the master node and set the --encryption-provider-config parameter to the path of that file: --encryption-provider-config=&lt;/path/to/EncryptionConfig/File&gt;

1.2.33 Follow the Kubernetes documentation and configure a EncryptionConfig file.
In this file, choose aescbc, kms or secretbox as the encryption provider.

1.2.34 Edit the API server pod specification file /etc/kubernetes/manifests/kube-apiserver.yaml
on the master node and set the below parameter.
--tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM
_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM
_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM
_SHA384

1.3.1 Edit the Controller Manager pod specification file /etc/kubernetes/manifests/kube-controller-manager.yaml
on the master node and set the --terminated-pod-gc-threshold to an appropriate threshold,
for example:
--terminated-pod-gc-threshold=10

1.3.2 Edit the Controller Manager pod specification file /etc/kubernetes/manifests/kube-controller-manager.yaml
on the master node and set the below parameter.
--profiling=false

1.4.1 Edit the Scheduler pod specification file /etc/kubernetes/manifests/kube-scheduler.yaml file
on the master node and set the below parameter.
--profiling=false


== Summary master ==
39 checks PASS
12 checks FAIL
13 checks WARN
0 checks INFO

[INFO] 2 Etcd Node Configuration
[INFO] 2 Etcd Node Configuration Files
[PASS] 2.1 Ensure that the --cert-file and --key-file arguments are set as appropriate (Automated)
[PASS] 2.2 Ensure that the --client-cert-auth argument is set to true (Automated)
[PASS] 2.3 Ensure that the --auto-tls argument is not set to true (Automated)
[PASS] 2.4 Ensure that the --peer-cert-file and --peer-key-file arguments are set as appropriate (Automated)
[PASS] 2.5 Ensure that the --peer-client-cert-auth argument is set to true (Automated)
[PASS] 2.6 Ensure that the --peer-auto-tls argument is not set to true (Automated)
[PASS] 2.7 Ensure that a unique Certificate Authority is used for etcd (Manual)

== Summary etcd ==
7 checks PASS
0 checks FAIL
0 checks WARN
0 checks INFO

[INFO] 3 Control Plane Configuration
[INFO] 3.1 Authentication and Authorization
[WARN] 3.1.1 Client certificate authentication should not be used for users (Manual)
[INFO] 3.2 Logging
[WARN] 3.2.1 Ensure that a minimal audit policy is created (Manual)
[WARN] 3.2.2 Ensure that the audit policy covers key security concerns (Manual)

== Remediations controlplane ==
3.1.1 Alternative mechanisms provided by Kubernetes such as the use of OIDC should be
implemented in place of client certificates.

3.2.1 Create an audit policy file for your cluster.

3.2.2 Consider modification of the audit policy in use on the cluster to include these items, at a
minimum.


== Summary controlplane ==
0 checks PASS
0 checks FAIL
3 checks WARN
0 checks INFO

[INFO] 4 Worker Node Security Configuration
[INFO] 4.1 Worker Node Configuration Files
[PASS] 4.1.1 Ensure that the kubelet service file permissions are set to 644 or more restrictive (Automated)
[PASS] 4.1.2 Ensure that the kubelet service file ownership is set to root:root (Automated)
[PASS] 4.1.3 If proxy kubeconfig file exists ensure permissions are set to 644 or more restrictive (Manual)
[PASS] 4.1.4 If proxy kubeconfig file exists ensure ownership is set to root:root (Manual)
[PASS] 4.1.5 Ensure that the --kubeconfig kubelet.conf file permissions are set to 644 or more restrictive (Automated)
[PASS] 4.1.6 Ensure that the --kubeconfig kubelet.conf file ownership is set to root:root (Automated)
[WARN] 4.1.7 Ensure that the certificate authorities file permissions are set to 644 or more restrictive (Manual)
[WARN] 4.1.8 Ensure that the client certificate authorities file ownership is set to root:root (Manual)
[PASS] 4.1.9 Ensure that the kubelet --config configuration file has permissions set to 644 or more restrictive (Automated)
[PASS] 4.1.10 Ensure that the kubelet --config configuration file ownership is set to root:root (Automated)
[INFO] 4.2 Kubelet
[PASS] 4.2.1 Ensure that the anonymous-auth argument is set to false (Automated)
[PASS] 4.2.2 Ensure that the --authorization-mode argument is not set to AlwaysAllow (Automated)
[PASS] 4.2.3 Ensure that the --client-ca-file argument is set as appropriate (Automated)
[PASS] 4.2.4 Ensure that the --read-only-port argument is set to 0 (Manual)
[PASS] 4.2.5 Ensure that the --streaming-connection-idle-timeout argument is not set to 0 (Manual)
[FAIL] 4.2.6 Ensure that the --protect-kernel-defaults argument is set to true (Automated)
[PASS] 4.2.7 Ensure that the --make-iptables-util-chains argument is set to true (Automated)
[WARN] 4.2.8 Ensure that the --hostname-override argument is not set (Manual)
[WARN] 4.2.9 Ensure that the --event-qps argument is set to 0 or a level which ensures appropriate event capture (Manual)
[WARN] 4.2.10 Ensure that the --tls-cert-file and --tls-private-key-file arguments are set as appropriate (Manual)
[PASS] 4.2.11 Ensure that the --rotate-certificates argument is not set to false (Automated)
[PASS] 4.2.12 Verify that the RotateKubeletServerCertificate argument is set to true (Manual)
[WARN] 4.2.13 Ensure that the Kubelet only makes use of Strong Cryptographic Ciphers (Manual)

== Remediations node ==
4.1.7 Run the following command to modify the file permissions of the
--client-ca-file chmod 644 &lt;filename&gt;

4.1.8 Run the following command to modify the ownership of the --client-ca-file.
chown root:root &lt;filename&gt;

4.2.6 If using a Kubelet config file, edit the file to set protectKernelDefaults: true.
If using command line arguments, edit the kubelet service file
/etc/systemd/system/kubelet.service.d/10-kubeadm.conf on each worker node and
set the below parameter in KUBELET_SYSTEM_PODS_ARGS variable.
--protect-kernel-defaults=true
Based on your system, restart the kubelet service. For example:
systemctl daemon-reload
systemctl restart kubelet.service

4.2.8 Edit the kubelet service file /etc/systemd/system/kubelet.service.d/10-kubeadm.conf
on each worker node and remove the --hostname-override argument from the
KUBELET_SYSTEM_PODS_ARGS variable.
Based on your system, restart the kubelet service. For example:
systemctl daemon-reload
systemctl restart kubelet.service

4.2.9 If using a Kubelet config file, edit the file to set eventRecordQPS: to an appropriate level.
If using command line arguments, edit the kubelet service file
/etc/systemd/system/kubelet.service.d/10-kubeadm.conf on each worker node and
set the below parameter in KUBELET_SYSTEM_PODS_ARGS variable.
Based on your system, restart the kubelet service. For example:
systemctl daemon-reload
systemctl restart kubelet.service

4.2.10 If using a Kubelet config file, edit the file to set tlsCertFile to the location
of the certificate file to use to identify this Kubelet, and tlsPrivateKeyFile
to the location of the corresponding private key file.
If using command line arguments, edit the kubelet service file
/etc/systemd/system/kubelet.service.d/10-kubeadm.conf on each worker node and
set the below parameters in KUBELET_CERTIFICATE_ARGS variable.
--tls-cert-file=&lt;path/to/tls-certificate-file&gt;
--tls-private-key-file=&lt;path/to/tls-key-file&gt;
Based on your system, restart the kubelet service. For example:
systemctl daemon-reload
systemctl restart kubelet.service

4.2.13 If using a Kubelet config file, edit the file to set TLSCipherSuites: to
TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256
or to a subset of these values.
If using executable arguments, edit the kubelet service file
/etc/systemd/system/kubelet.service.d/10-kubeadm.conf on each worker node and
set the --tls-cipher-suites parameter as follows, or to a subset of these values.
--tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256
Based on your system, restart the kubelet service. For example:
systemctl daemon-reload
systemctl restart kubelet.service


== Summary node ==
16 checks PASS
1 checks FAIL
6 checks WARN
0 checks INFO

[INFO] 5 Kubernetes Policies
[INFO] 5.1 RBAC and Service Accounts
[WARN] 5.1.1 Ensure that the cluster-admin role is only used where required (Manual)
[WARN] 5.1.2 Minimize access to secrets (Manual)
[WARN] 5.1.3 Minimize wildcard use in Roles and ClusterRoles (Manual)
[WARN] 5.1.4 Minimize access to create pods (Manual)
[WARN] 5.1.5 Ensure that default service accounts are not actively used. (Manual)
[WARN] 5.1.6 Ensure that Service Account Tokens are only mounted where necessary (Manual)
[WARN] 5.1.7 Avoid use of system:masters group (Manual)
[WARN] 5.1.8 Limit use of the Bind, Impersonate and Escalate permissions in the Kubernetes cluster (Manual)
[INFO] 5.2 Pod Security Policies
[WARN] 5.2.1 Minimize the admission of privileged containers (Automated)
[WARN] 5.2.2 Minimize the admission of containers wishing to share the host process ID namespace (Automated)
[WARN] 5.2.3 Minimize the admission of containers wishing to share the host IPC namespace (Automated)
[WARN] 5.2.4 Minimize the admission of containers wishing to share the host network namespace (Automated)
[WARN] 5.2.5 Minimize the admission of containers with allowPrivilegeEscalation (Automated)
[WARN] 5.2.6 Minimize the admission of root containers (Automated)
[WARN] 5.2.7 Minimize the admission of containers with the NET_RAW capability (Automated)
[WARN] 5.2.8 Minimize the admission of containers with added capabilities (Automated)
[WARN] 5.2.9 Minimize the admission of containers with capabilities assigned (Manual)
[INFO] 5.3 Network Policies and CNI
[WARN] 5.3.1 Ensure that the CNI in use supports Network Policies (Manual)
[WARN] 5.3.2 Ensure that all Namespaces have Network Policies defined (Manual)
[INFO] 5.4 Secrets Management
[WARN] 5.4.1 Prefer using secrets as files over secrets as environment variables (Manual)
[WARN] 5.4.2 Consider external secret storage (Manual)
[INFO] 5.5 Extensible Admission Control
[WARN] 5.5.1 Configure Image Provenance using ImagePolicyWebhook admission controller (Manual)
[INFO] 5.7 General Policies
[WARN] 5.7.1 Create administrative boundaries between resources using namespaces (Manual)
[WARN] 5.7.2 Ensure that the seccomp profile is set to docker/default in your pod definitions (Manual)
[WARN] 5.7.3 Apply Security Context to Your Pods and Containers (Manual)
[WARN] 5.7.4 The default namespace should not be used (Manual)

== Remediations policies ==
5.1.1 Identify all clusterrolebindings to the cluster-admin role. Check if they are used and
if they need this role or if they could use a role with fewer privileges.
Where possible, first bind users to a lower privileged role and then remove the
clusterrolebinding to the cluster-admin role :
kubectl delete clusterrolebinding [name]

5.1.2 Where possible, remove get, list and watch access to secret objects in the cluster.

5.1.3 Where possible replace any use of wildcards in clusterroles and roles with specific
objects or actions.

5.1.4 Where possible, remove create access to pod objects in the cluster.

5.1.5 Create explicit service accounts wherever a Kubernetes workload requires specific access
to the Kubernetes API server.
Modify the configuration of each default service account to include this value
automountServiceAccountToken: false

5.1.6 Modify the definition of pods and service accounts which do not need to mount service
account tokens to disable it.

5.1.7 Remove the system:masters group from all users in the cluster.

5.1.8 Where possible, remove the impersonate, bind and escalate rights from subjects.

5.2.1 Create a PSP as described in the Kubernetes documentation, ensuring that
the .spec.privileged field is omitted or set to false.

5.2.2 Create a PSP as described in the Kubernetes documentation, ensuring that the
.spec.hostPID field is omitted or set to false.

5.2.3 Create a PSP as described in the Kubernetes documentation, ensuring that the
.spec.hostIPC field is omitted or set to false.

5.2.4 Create a PSP as described in the Kubernetes documentation, ensuring that the
.spec.hostNetwork field is omitted or set to false.

5.2.5 Create a PSP as described in the Kubernetes documentation, ensuring that the
.spec.allowPrivilegeEscalation field is omitted or set to false.

5.2.6 Create a PSP as described in the Kubernetes documentation, ensuring that the
.spec.runAsUser.rule is set to either MustRunAsNonRoot or MustRunAs with the range of
UIDs not including 0.

5.2.7 Create a PSP as described in the Kubernetes documentation, ensuring that the
.spec.requiredDropCapabilities is set to include either NET_RAW or ALL.

5.2.8 Ensure that allowedCapabilities is not present in PSPs for the cluster unless
it is set to an empty array.

5.2.9 Review the use of capabilites in applications running on your cluster. Where a namespace
contains applicaions which do not require any Linux capabities to operate consider adding
a PSP which forbids the admission of containers which do not drop all capabilities.

5.3.1 If the CNI plugin in use does not support network policies, consideration should be given to
making use of a different plugin, or finding an alternate mechanism for restricting traffic
in the Kubernetes cluster.

5.3.2 Follow the documentation and create NetworkPolicy objects as you need them.

5.4.1 if possible, rewrite application code to read secrets from mounted secret files, rather than
from environment variables.

5.4.2 Refer to the secrets management options offered by your cloud provider or a third-party
secrets management solution.

5.5.1 Follow the Kubernetes documentation and setup image provenance.

5.7.1 Follow the documentation and create namespaces for objects in your deployment as you need
them.

5.7.2 Use security context to enable the docker/default seccomp profile in your pod definitions.
An example is as below:
  securityContext:
    seccompProfile:
      type: RuntimeDefault

5.7.3 Follow the Kubernetes documentation and apply security contexts to your pods. For a
suggested list of security contexts, you may refer to the CIS Security Benchmark for Docker
Containers.

5.7.4 Ensure that namespaces are created to allow for appropriate segregation of Kubernetes
resources and that all new resources are created in a specific namespace.


== Summary policies ==
0 checks PASS
0 checks FAIL
26 checks WARN
0 checks INFO

== Summary total ==
62 checks PASS
13 checks FAIL
48 checks WARN
0 checks INFO
</code></pre></details><p>This can also be run inside the AKS cluster by following the instructions <a href=https://github.com/aquasecurity/kube-bench/blob/main/docs/running.md#running-in-an-aks-cluster target=_blank>here</a>.
As a reminder: Kube-bench cannot be run on AKS master nodes. It can only be run on worker nodes, this is not a limitation of Kube-bench but of AKS as mentioned before.</p><h3 class="relative group">The report breakdown<div id=the-report-breakdown class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-report-breakdown aria-label=Anchor>#</a></span></h3><p>From the report above you can see that Kube-bench benchmarks 5 sections of your configurations which are the following:</p><ul><li>Control Plane Components</li><li>Etcd</li><li>Control Plane Configurations</li><li>Worker Nodes</li><li>Policies</li></ul><p>Each section starts by describing which section it targets, the lines having the INFO tag. For example:</p><pre tabindex=0><code class=language-log data-lang=log>[INFO] 5 Kubernetes Policies
[INFO] 5.1 RBAC and Service Accounts
</code></pre><p>Then it lists the checks that are performed for that section. Each check gets a PASS, FAIL or WARN status. For example:</p><pre tabindex=0><code class=language-log data-lang=log>[WARN] 5.1.1 Ensure that the cluster-admin role is only used where required (Manual)
</code></pre><p>And after the tests run, it also suggests remediations for the check that got a WARN/FAIL status. For example:</p><pre tabindex=0><code class=language-log data-lang=log>== Remediations policies ==
5.1.1 Identify all clusterrolebindings to the cluster-admin role. Check if they are used and
if they need this role or if they could use a role with fewer privileges.
Where possible, first bind users to a lower privileged role and then remove the
clusterrolebinding to the cluster-admin role :
kubectl delete clusterrolebinding [name]
</code></pre><p>And at the end you can find a summary of the section:</p><pre tabindex=0><code class=language-log data-lang=log>== Summary policies ==
0 checks PASS
0 checks FAIL
26 checks WARN
0 checks INFO
</code></pre><h3 class="relative group">Potential use cases<div id=potential-use-cases class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#potential-use-cases aria-label=Anchor>#</a></span></h3><p>By running it as a CronJon in your cluster, Kube-bench can help you identify potential security issues in your cluster. It is a great tool to have in your toolbox and it is very easy to use.
You can configure it to run on a schedule like every week or month and get a report on the security of your cluster, while also taking into account the specific CIS benchmark for your cloud provider. For example, you can set up and run the <a href=https://github.com/aquasecurity/kube-bench/blob/main/job-aks.yaml target=_blank>job-aks.yaml</a> file to run the tests on an AKS cluster.</p><h2 class="relative group">Popeye - A Kubernetes Cluster Sanitizer<div id=popeye---a-kubernetes-cluster-sanitizer class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#popeye---a-kubernetes-cluster-sanitizer aria-label=Anchor>#</a></span></h2><p><figure><img class="my-0 rounded-md" loading=lazy srcset="/posts/k8s-aks-security-helpers/popeye_logo_hu1c81c20b1b123d5fe004e6b5bab881df_108366_330x0_resize_box_3.png 330w,
/posts/k8s-aks-security-helpers/popeye_logo_hu1c81c20b1b123d5fe004e6b5bab881df_108366_660x0_resize_box_3.png 660w,
/posts/k8s-aks-security-helpers/popeye_logo_hu1c81c20b1b123d5fe004e6b5bab881df_108366_1024x0_resize_box_3.png 1024w,
/posts/k8s-aks-security-helpers/popeye_logo_hu1c81c20b1b123d5fe004e6b5bab881df_108366_1320x0_resize_box_3.png 2x" src=/posts/k8s-aks-security-helpers/popeye_logo_hu1c81c20b1b123d5fe004e6b5bab881df_108366_660x0_resize_box_3.png alt=Popeye></figure></p><p>The repository for the tool can be found <a href=https://github.com/derailed/popeye target=_blank>here</a>.</p><p>This is a read-only utility that scans live Kubernetes clusters and reports potential issues with deployed resources and configurations.
What I liked about this tool is that it is very easy to install and use and it achieves what it promises: it reduces the cognitive overload one faces when operating a Kubernetes cluster in the wild.</p><h3 class="relative group">Setting it up<div id=setting-it-up-1 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#setting-it-up-1 aria-label=Anchor>#</a></span></h3><p>Popeye can be used standalone using the command line, using a <a href=https://github.com/derailed/popeye/blob/master/spinach/spinach_aks.yml target=_blank>spinach.yml</a> file or running directly in the cluster as a CronJob.</p><p>In this post, I will be using the command line option on a mac. So to install it I just ran:</p><pre tabindex=0><code class=language-log data-lang=log># Install popeye
&gt; brew install derailed/popeye/popeye
# Check popeye version
&gt; popeye version                                                                                                                   
 ___     ___ _____   _____                       K          .-&#39;-.
| _ \___| _ \ __\ \ / / __|                       8     __|      `\
|  _/ _ \  _/ _| \ V /| _|                         s   `-,-`--._   `\
|_| \___/_| |___| |_| |___|                       []  .-&gt;&#39;  a     `|-&#39;
  Biffs`em and Buffs`em!                            `=/ (__/_       /
                                                      \_,    `    _)
                                                         `----;  |
Version:   0.10.1
Commit:    ae19897a4b5d3738a3e98179207759e45a53a64c
Date:      2022-06-28T14:46:13Z
Logs:      /var/folders/vp/l8dlq0gn3x71f3vk82shmzlm0000gn/T/popeye.log

# Connected to my AKS cluster
# Check the context I am using
&gt; kubectl config current-context
# Run popeye
&gt; popeye
</code></pre><h3 class="relative group">The report breakdown<div id=the-report-breakdown-1 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-report-breakdown-1 aria-label=Anchor>#</a></span></h3><p>The report will be printed to the console and it will look something like the following snippet below. I have removed some of the output for brevity and to give you an idea of the output format and the types of checks that are performed and the results.</p><p>The report is nicely split into sections and each section has a summary of the checks performed and the results. It ends with giving a grade to the cluster.</p><p>The color coding is also very helpful to quickly identify the issues:</p><table><thead><tr><th><strong>Level</strong></th><th style=text-align:center><strong>Icon</strong></th><th style=text-align:center><strong>Jurassic</strong></th><th style=text-align:center><strong>Color</strong></th><th style=text-align:center><strong>Description</strong></th></tr></thead><tbody><tr><td>Ok</td><td style=text-align:center>✅</td><td style=text-align:center>OK</td><td style=text-align:center>Green</td><td style=text-align:center>Happy!</td></tr><tr><td>Info</td><td style=text-align:center>🔊</td><td style=text-align:center>I</td><td style=text-align:center>BlueGreen</td><td style=text-align:center>FYI</td></tr><tr><td>Warn</td><td style=text-align:center>😱</td><td style=text-align:center>W</td><td style=text-align:center>Yellow</td><td style=text-align:center>Potential Issue</td></tr><tr><td>Error</td><td style=text-align:center>💥</td><td style=text-align:center>E</td><td style=text-align:center>Red</td><td style=text-align:center>Action required</td></tr></tbody></table><details><summary>Click here to expand report</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; popeye                                                                                                                                      
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> ___     ___ _____   _____                                                      K          .-<span class=s1>&#39;-.
</span></span></span><span class=line><span class=cl><span class=s1>| _ \___| _ \ __\ \ / / __|                                                      8     __|      `\
</span></span></span><span class=line><span class=cl><span class=s1>|  _/ _ \  _/ _| \ V /| _|                                                        s   `-,-`--._   `\
</span></span></span><span class=line><span class=cl><span class=s1>|_| \___/_| |___| |_| |___|                                                      []  .-&gt;&#39;</span>  a     <span class=sb>`</span><span class=p>|</span>-<span class=s1>&#39;
</span></span></span><span class=line><span class=cl><span class=s1>  Biffs`em and Buffs`em!                                                          `=/ (__/_       /
</span></span></span><span class=line><span class=cl><span class=s1>                                                                                    \_,    `    _)
</span></span></span><span class=line><span class=cl><span class=s1>                                                                                       `----;  |
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>GENERAL [AKS-STAGING]
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>  · Connectivity...................................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · MetricServer...................................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>CLUSTER (1 SCANNED)                                                          💥 0 😱 0 🔊 0 ✅ 1 100٪
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>  · Version........................................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>    ✅ [POP-406] K8s version OK.
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>CLUSTERROLES (13 SCANNED)                                                   💥 0 😱 0 🔊 0 ✅ 13 100٪
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>  · azure-policy-webhook-cluster-role..............................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-operator-admin............................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · dashboard-reader...............................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · gatekeeper-manager-role........................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · grafana-agent..................................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · keda-operator..................................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · keda-operator-external-metrics-reader..........................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kong-kong......................................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · omsagent-reader................................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · policy-agent...................................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · system:coredns-autoscaler......................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · system:metrics-server..........................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · system:prometheus..............................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>CLUSTERROLEBINDINGS (19 SCANNED)                                             💥 0 😱 6 🔊 0 ✅ 13 68٪
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>  · azure-policy-webhook-cluster-rolebinding.......................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-operator..................................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-role-tokenreview-binding..................................................................😱
</span></span></span><span class=line><span class=cl><span class=s1>    😱 [POP-1300] References a ClusterRole (system:auth-delegator) which does not exist.
</span></span></span><span class=line><span class=cl><span class=s1>  · dashboard-reader-global........................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · gatekeeper-manager-rolebinding.................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · grafana-agent..................................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · keda-operator..................................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · keda-operator-hpa-controller-external-metrics..................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · keda-operator-system-auth-delegator............................................................😱
</span></span></span><span class=line><span class=cl><span class=s1>    😱 [POP-1300] References a ClusterRole (system:auth-delegator) which does not exist.
</span></span></span><span class=line><span class=cl><span class=s1>  · kong-kong......................................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kubelet-api-admin..............................................................................😱
</span></span></span><span class=line><span class=cl><span class=s1>    😱 [POP-1300] References a ClusterRole (system:kubelet-api-admin) which does not exist.
</span></span></span><span class=line><span class=cl><span class=s1>  · metrics-server:system:auth-delegator...........................................................😱
</span></span></span><span class=line><span class=cl><span class=s1>    😱 [POP-1300] References a ClusterRole (system:auth-delegator) which does not exist.
</span></span></span><span class=line><span class=cl><span class=s1>  · omsagentclusterrolebinding.....................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · policy-agent...................................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · replicaset-controller..........................................................................😱
</span></span></span><span class=line><span class=cl><span class=s1>    😱 [POP-1300] References a ClusterRole (system:controller:replicaset-controller) which does not
</span></span></span><span class=line><span class=cl><span class=s1>       exist.
</span></span></span><span class=line><span class=cl><span class=s1>  · system:coredns-autoscaler......................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · system:discovery...............................................................................😱
</span></span></span><span class=line><span class=cl><span class=s1>    😱 [POP-1300] References a ClusterRole (system:discovery) which does not exist.
</span></span></span><span class=line><span class=cl><span class=s1>  · system:metrics-server..........................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · system:prometheus..............................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>CONFIGMAPS (43 SCANNED)                                                     💥 0 😱 0 🔊 37 ✅ 6 100٪
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/kube-root-ca.crt...................................................................🔊
</span></span></span><span class=line><span class=cl><span class=s1>    🔊 [POP-400] Used? Unable to locate resource reference.
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/operator.dapr.io...................................................................🔊
</span></span></span><span class=line><span class=cl><span class=s1>    🔊 [POP-400] Used? Unable to locate resource reference.
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/webhooks.dapr.io...................................................................🔊
</span></span></span><span class=line><span class=cl><span class=s1>    🔊 [POP-400] Used? Unable to locate resource reference.
</span></span></span><span class=line><span class=cl><span class=s1>  · default/kube-root-ca.crt.......................................................................🔊
</span></span></span><span class=line><span class=cl><span class=s1>    🔊 [POP-400] Used? Unable to locate resource reference.
</span></span></span><span class=line><span class=cl><span class=s1>(...)
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>DAEMONSETS (9 SCANNED)                                                        💥 0 😱 2 🔊 0 ✅ 7 77٪
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system/azure-ip-masq-agent................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system/cloud-node-manager.................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system/cloud-node-manager-windows.........................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system/csi-azuredisk-node.................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system/csi-azuredisk-node-win.............................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system/csi-azurefile-node.................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system/csi-azurefile-node-win.............................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system/kube-proxy.........................................................................😱
</span></span></span><span class=line><span class=cl><span class=s1>    🐳 kube-proxy
</span></span></span><span class=line><span class=cl><span class=s1>      😱 [POP-107] No resource limits defined.
</span></span></span><span class=line><span class=cl><span class=s1>    🐳 kube-proxy-bootstrap
</span></span></span><span class=line><span class=cl><span class=s1>      😱 [POP-107] No resource limits defined.
</span></span></span><span class=line><span class=cl><span class=s1>  · prometheus-agent/grafana-agent.................................................................😱
</span></span></span><span class=line><span class=cl><span class=s1>    🐳 agent
</span></span></span><span class=line><span class=cl><span class=s1>      😱 [POP-106] No resources requests/limits defined.
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>DEPLOYMENTS (29 SCANNED)                                                     💥 0 😱 4 🔊 3 ✅ 22 86٪
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-dashboard.....................................................................🔊
</span></span></span><span class=line><span class=cl><span class=s1>    🐳 dapr-dashboard
</span></span></span><span class=line><span class=cl><span class=s1>      🔊 [POP-108] Unnamed port 8080.
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-operator......................................................................🔊
</span></span></span><span class=line><span class=cl><span class=s1>    🐳 dapr-operator
</span></span></span><span class=line><span class=cl><span class=s1>      🔊 [POP-108] Unnamed port 6500.
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-sentry........................................................................🔊
</span></span></span><span class=line><span class=cl><span class=s1>    🐳 dapr-sentry
</span></span></span><span class=line><span class=cl><span class=s1>      🔊 [POP-108] Unnamed port 50001.
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-sidecar-injector..............................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · gatekeeper-system/gatekeeper-audit.............................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · gatekeeper-system/gatekeeper-controller........................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · keda-system/keda-operator......................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · keda-system/keda-operator-metrics-apiserver....................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kong/kong-kong.................................................................................😱
</span></span></span><span class=line><span class=cl><span class=s1>    🐳 ingress-controller
</span></span></span><span class=line><span class=cl><span class=s1>      😱 [POP-106] No resources requests/limits defined.
</span></span></span><span class=line><span class=cl><span class=s1>    🐳 proxy
</span></span></span><span class=line><span class=cl><span class=s1>      😱 [POP-106] No resources requests/limits defined.
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system/azure-policy.......................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system/azure-policy-webhook...............................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system/coredns............................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system/coredns-autoscaler.................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system/konnectivity-agent.................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system/metrics-server.....................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>(...)
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>HORIZONTALPODAUTOSCALERS (4 SCANNED)                                          💥 0 😱 2 🔊 0 ✅ 2 50٪
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>  · HPA............................................................................................😱
</span></span></span><span class=line><span class=cl><span class=s1>    😱 [POP-604] If ALL HPAs triggered, 11500m will match/exceed cluster CPU(4931m) capacity by
</span></span></span><span class=line><span class=cl><span class=s1>       6570m.
</span></span></span><span class=line><span class=cl><span class=s1>    😱 [POP-605] If ALL HPAs triggered, 14720Mi will match/exceed cluster memory(1523Mi) capacity by
</span></span></span><span class=line><span class=cl><span class=s1>       13196Mi.
</span></span></span><span class=line><span class=cl><span class=s1>  · my-service/keda-hpa-my-service.................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · my-service-2/keda-hpa-my-service-2.............................................................😱
</span></span></span><span class=line><span class=cl><span class=s1>    😱 [POP-602] Replicas (1/100) at burst will match/exceed cluster CPU(4931m) capacity by 5070m.
</span></span></span><span class=line><span class=cl><span class=s1>    😱 [POP-603] Replicas (1/100) at burst will match/exceed cluster memory(1523Mi) capacity by
</span></span></span><span class=line><span class=cl><span class=s1>       11276Mi.
</span></span></span><span class=line><span class=cl><span class=s1>(...)
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>INGRESSES (13 SCANNED)                                                      💥 0 😱 0 🔊 0 ✅ 13 100٪
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>  · my-service/my-service..........................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kong/kong-dapr.................................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>(...)
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>NAMESPACES (23 SCANNED)                                                     💥 0 😱 0 🔊 3 ✅ 20 100٪
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system....................................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · default........................................................................................🔊
</span></span></span><span class=line><span class=cl><span class=s1>    🔊 [POP-400] Used? Unable to locate resource reference.
</span></span></span><span class=line><span class=cl><span class=s1>  · gatekeeper-system..............................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · keda-system....................................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kong...........................................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-node-lease................................................................................🔊
</span></span></span><span class=line><span class=cl><span class=s1>    🔊 [POP-400] Used? Unable to locate resource reference.
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-public....................................................................................🔊
</span></span></span><span class=line><span class=cl><span class=s1>    🔊 [POP-400] Used? Unable to locate resource reference.
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system....................................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · logstash.......................................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · prometheus-agent...............................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>(...)
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>NETWORKPOLICIES (2 SCANNED)                                                  💥 0 😱 0 🔊 0 ✅ 2 100٪
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system/konnectivity-agent.................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system/tunnelfront........................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>NODES (3 SCANNED)                                                             💥 0 😱 2 🔊 0 ✅ 1 33٪
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>  · aks-default-***-vmss000000.....................................................................😱
</span></span></span><span class=line><span class=cl><span class=s1>    😱 [POP-710] Memory threshold (80%) reached 83%.
</span></span></span><span class=line><span class=cl><span class=s1>  · aks-default-***-vmss000001.....................................................................😱
</span></span></span><span class=line><span class=cl><span class=s1>    😱 [POP-710] Memory threshold (80%) reached 105%.
</span></span></span><span class=line><span class=cl><span class=s1>  · aks-default-***-vmss00000a.....................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>PERSISTENTVOLUMES (3 SCANNED)                                                💥 0 😱 0 🔊 0 ✅ 3 100٪
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>  · pvc-**.........................................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · pvc-**.........................................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · pvc-**.........................................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>PERSISTENTVOLUMECLAIMS (3 SCANNED)                                           💥 0 😱 0 🔊 0 ✅ 3 100٪
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/raft-log-dapr-placement-server-0...................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/raft-log-dapr-placement-server-1...................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/raft-log-dapr-placement-server-2...................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>PODS (72 SCANNED)                                                             💥 1 😱 71 🔊 0 ✅ 0 0٪
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-dashboard-1-lq942.............................................................😱
</span></span></span><span class=line><span class=cl><span class=s1>    😱 [POP-301] Connects to API Server? ServiceAccount token is mounted.
</span></span></span><span class=line><span class=cl><span class=s1>    🐳 dapr-dashboard
</span></span></span><span class=line><span class=cl><span class=s1>      😱 [POP-102] No probes defined.
</span></span></span><span class=line><span class=cl><span class=s1>      🔊 [POP-108] Unnamed port 8080.
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-operator-1-chmmq..............................................................😱
</span></span></span><span class=line><span class=cl><span class=s1>    😱 [POP-301] Connects to API Server? ServiceAccount token is mounted.
</span></span></span><span class=line><span class=cl><span class=s1>    🐳 dapr-operator
</span></span></span><span class=line><span class=cl><span class=s1>      😱 [POP-205] Pod was restarted (17) times.
</span></span></span><span class=line><span class=cl><span class=s1>      🔊 [POP-105] Liveness probe uses a port#, prefer a named port.
</span></span></span><span class=line><span class=cl><span class=s1>      🔊 [POP-105] Readiness probe uses a port#, prefer a named port.
</span></span></span><span class=line><span class=cl><span class=s1>      🔊 [POP-108] Unnamed port 6500.
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-placement-server-0............................................................😱
</span></span></span><span class=line><span class=cl><span class=s1>    😱 [POP-301] Connects to API Server? ServiceAccount token is mounted.
</span></span></span><span class=line><span class=cl><span class=s1>    😱 [POP-302] Pod could be running as root user. Check SecurityContext/Image.
</span></span></span><span class=line><span class=cl><span class=s1>    🐳 dapr-placement-server
</span></span></span><span class=line><span class=cl><span class=s1>      🔊 [POP-105] Liveness probe uses a port#, prefer a named port.
</span></span></span><span class=line><span class=cl><span class=s1>      🔊 [POP-105] Readiness probe uses a port#, prefer a named port.
</span></span></span><span class=line><span class=cl><span class=s1>      😱 [POP-306] Container could be running as root user. Check SecurityContext/Image.
</span></span></span><span class=line><span class=cl><span class=s1>(...)
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>PODDISRUPTIONBUDGETS (8 SCANNED)                                              💥 0 😱 2 🔊 0 ✅ 6 75٪
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-dashboard-disruption-budget...................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-operator-disruption-budget....................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-placement-server-disruption-budget............................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-sentry-budget.................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-sidecar-injector-disruption-budget............................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system/coredns-pdb........................................................................😱
</span></span></span><span class=line><span class=cl><span class=s1>    😱 [POP-403] Deprecated PodDisruptionBudget API group &#34;policy/v1beta1&#34;. Use &#34;policy/v1&#34; instead.
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system/konnectivity-agent.................................................................😱
</span></span></span><span class=line><span class=cl><span class=s1>    😱 [POP-403] Deprecated PodDisruptionBudget API group &#34;policy/v1beta1&#34;. Use &#34;policy/v1&#34; instead.
</span></span></span><span class=line><span class=cl><span class=s1>  · logstash/logstash-logstash-pdb.................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>PODSECURITYPOLICIES (0 SCANNED)                                              💥 0 😱 0 🔊 0 ✅ 0 100٪
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>  · Nothing to report.
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>REPLICASETS (197 SCANNED)                                                  💥 0 😱 0 🔊 0 ✅ 197 100٪
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-dashboard-1...................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-operator-1....................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-sentry-1......................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-sidecar-injector-1............................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · keda-system/keda-operator-1....................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · keda-system/keda-operator-metrics-apiserver-1..................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>(...)
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>ROLES (5 SCANNED)                                                            💥 0 😱 0 🔊 0 ✅ 5 100٪
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>  · default/secret-reader..........................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · gatekeeper-system/gatekeeper-manager-role......................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kong/kong-kong.................................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system/azure-policy-webhook-role..........................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system/policy-pod-agent...................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>ROLEBINDINGS (7 SCANNED)                                                      💥 0 😱 2 🔊 0 ✅ 5 71٪
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>  · default/dapr-secret-reader.....................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · gatekeeper-system/gatekeeper-manager-rolebinding...............................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kong/kong-kong.................................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system/azure-policy-webhook-rolebinding...................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system/keda-operator-auth-reader..........................................................😱
</span></span></span><span class=line><span class=cl><span class=s1>    😱 [POP-1300] References a Role (kube-system/extension-apiserver-authentication-reader) which
</span></span></span><span class=line><span class=cl><span class=s1>       does not exist.
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system/metrics-server-auth-reader.........................................................😱
</span></span></span><span class=line><span class=cl><span class=s1>    😱 [POP-1300] References a Role (kube-system/extension-apiserver-authentication-reader) which
</span></span></span><span class=line><span class=cl><span class=s1>       does not exist.
</span></span></span><span class=line><span class=cl><span class=s1>  · kube-system/policy-pod-agent...................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>SECRETS (277 SCANNED)                                                     💥 0 😱 0 🔊 254 ✅ 23 100٪
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-operator-token-tdnb4..........................................................🔊
</span></span></span><span class=line><span class=cl><span class=s1>    🔊 [POP-400] Used? Unable to locate resource reference.
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-sidecar-injector-cert.........................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-trust-bundle..................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>(...)
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>SERVICES (35 SCANNED)                                                        💥 3 😱 17 🔊 7 ✅ 8 42٪
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-api...........................................................................🔊
</span></span></span><span class=line><span class=cl><span class=s1>    🔊 [POP-1102] Use of target port #6500 for service port TCP::80. Prefer named port.
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-dashboard.....................................................................😱
</span></span></span><span class=line><span class=cl><span class=s1>    🔊 [POP-1102] Use of target port #8080 for service port TCP::8080. Prefer named port.
</span></span></span><span class=line><span class=cl><span class=s1>    😱 [POP-1109] Only one Pod associated with this endpoint.
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-placement-server..............................................................🔊
</span></span></span><span class=line><span class=cl><span class=s1>    🔊 [POP-1102] Use of target port #50005 for service port TCP:api:50005. Prefer named port.
</span></span></span><span class=line><span class=cl><span class=s1>    🔊 [POP-1102] Use of target port #8201 for service port TCP:raft-node:8201. Prefer named port.
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-sentry........................................................................🔊
</span></span></span><span class=line><span class=cl><span class=s1>    🔊 [POP-1102] Use of target port #50001 for service port TCP::80. Prefer named port.
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-sidecar-injector..............................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-webhook.......................................................................💥
</span></span></span><span class=line><span class=cl><span class=s1>    💥 [POP-1106] No target ports match service port TCP::443.
</span></span></span><span class=line><span class=cl><span class=s1>  · default/dapr-eventgrid-func-dapr...............................................................💥
</span></span></span><span class=line><span class=cl><span class=s1>    💥 [POP-1100] No pods match service selector.
</span></span></span><span class=line><span class=cl><span class=s1>    💥 [POP-1105] No associated endpoints.
</span></span></span><span class=line><span class=cl><span class=s1>  · default/kubernetes.............................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>(...)
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>SERVICEACCOUNTS (38 SCANNED)                                                 💥 0 😱 1 🔊 8 ✅ 29 97٪
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-operator......................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dashboard-reader...................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/default............................................................................🔊
</span></span></span><span class=line><span class=cl><span class=s1>    🔊 [POP-400] Used? Unable to locate resource reference.
</span></span></span><span class=line><span class=cl><span class=s1>  · default/default................................................................................🔊
</span></span></span><span class=line><span class=cl><span class=s1>    🔊 [POP-400] Used? Unable to locate resource reference.
</span></span></span><span class=line><span class=cl><span class=s1>  · domain-event-emitter/default...................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · domain-start/default...........................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · gatekeeper-system/default......................................................................🔊
</span></span></span><span class=line><span class=cl><span class=s1>    🔊 [POP-400] Used? Unable to locate resource reference.
</span></span></span><span class=line><span class=cl><span class=s1>  · gatekeeper-system/gatekeeper-admin.............................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>(...)
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>STATEFULSETS (2 SCANNED)                                                     💥 0 😱 0 🔊 0 ✅ 2 100٪
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>  · dapr-system/dapr-placement-server..............................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>  · logstash/logstash-logstash.....................................................................✅
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>SUMMARY
</span></span></span><span class=line><span class=cl><span class=s1>┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅
</span></span></span><span class=line><span class=cl><span class=s1>Your cluster score: 82 -- B
</span></span></span><span class=line><span class=cl><span class=s1>                                                                                o          .-&#39;</span>-.
</span></span><span class=line><span class=cl>                                                                                 o     __<span class=p>|</span> B    <span class=sb>`</span><span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                                                                                  o   <span class=sb>`</span>-,-<span class=sb>`</span>--._   <span class=sb>`</span><span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                                                                                 <span class=o>[]</span>  .-&gt;<span class=s1>&#39;  a     `|-&#39;</span>
</span></span><span class=line><span class=cl>                                                                                  <span class=sb>`</span><span class=o>=</span>/ <span class=o>(</span>__/_       /
</span></span><span class=line><span class=cl>                                                                                    <span class=se>\_</span>,    <span class=sb>`</span>    _<span class=o>)</span>
</span></span><span class=line><span class=cl>                                                                                       <span class=sb>`</span>----<span class=p>;</span>  <span class=p>|</span>
</span></span></code></pre></div></details><p>Popeye has a bit of a different scope than Kube-bench in the sense that it scans your cluster for best practices and potential issues. It is not a security scanner like Kube-bench, but it can be used to find potential security issues and for your cluster management.</p><p>It targets the following:</p><ul><li>nodes</li><li>namespaces</li><li>pods</li><li>services</li></ul><p>Its main scope is to find misconfigurations like port mismatches, dead or unused resources etc. You can find the full list of available sanitizers <a href=https://github.com/derailed/popeye#sanitizers target=_blank>here</a>.</p><h3 class="relative group">Potential use cases<div id=potential-use-cases-1 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#potential-use-cases-1 aria-label=Anchor>#</a></span></h3><p>Should you choose it to run in a pipeline or as a job you can build on it and make action items to fix based on the errors reported in the report.</p><p>Or this could just be a little helpful tool to run on your cluster to get a quick overview of the state of your cluster. And you can extract any action items for yourself. In this case, you can save the report using the <code>--save</code> flag and attach it to your JIRA Ticket or PR.</p><p>This will save the report in your current working directory.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; popeye --save                                                                                                                    
</span></span><span class=line><span class=cl>/var/folders/vp/l8dlq0gn3x71f3vk82shmzlm0000gn/T/popeye/sanitizer_aks-staging_1673563387070145000.txt
</span></span></code></pre></div><h2 class="relative group">Summary<div id=summary class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#summary aria-label=Anchor>#</a></span></h2><p>I quite enjoyed using both Popeye and Kube-bench. They are both very useful in different ways. Popeye is more of a cluster management tool, while Kube-bench is more of a security scanner. But they can both be used to improve the security of your cluster.</p><p>In the next posts from this series, we will take a deeper look at the reports in more detail, focusing on the errors and seeing what we can do to improve our cluster score.</p><p><em>Until then, thank you for reading and I hope you found this useful. Let me know what other tools you use</em></p></div></div><script>var oid="views_posts/k8s-aks-security-helpers/index.md",oid_likes="likes_posts/k8s-aks-security-helpers/index.md"</script><script type=text/javascript src=/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q+oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/posts/terraform-vs-helm-for-managing-k8s-objects/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Terraform vs Helm for Managing K8s Objects</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2022-08-10 19:34:20 +0100 +0100">10 August 2022</time>
</span></span></a></span><span><a class="flex text-right group ml-3" href=/posts/k8s-pod-createcontainerconfigerror/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Troubleshooting and Resolving a Pod Stuck in 'CreateContainerConfigError' in Kubernetes</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2023-01-30 22:38:04 +0100 +0100">30 January 2023</time>
</span></span><span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex flex-col list-none sm:flex-row"><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href title></a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2024
Ana Cozma</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://ana-cozma.github.io/ style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>